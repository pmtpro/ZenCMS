function htmlspecialchars(str) {
    if (typeof(str) == "string") {
        str = str.replace(/&/g, "&amp;");
        /* must do &amp; first */
        str = str.replace(/"/g, "&quot;");
        str = str.replace(/'/g, "&#039;");
        str = str.replace(/</g, "&lt;");
        str = str.replace(/>/g, "&gt;");
    }
    return str;
}

tinymce.PluginManager.add("insert_code", function (e) {
    function t() {

        var text = e.selection.getContent({format: 'text'});
        if (text != null && text != 'undefined' && text != '') {
            e.insertContent("<span class=\"codeStyle\">" + htmlspecialchars(text) + "</span>\n&nbsp;");
        } else {
            e.windowManager.open({title: "Thêm code", body: {type: "textbox", name: "code", multiline: !0, minWidth: 600, minHeight: 200, value: "", spellcheck: !1}, onSubmit: function (t) {
                e.insertContent("<span class=\"codeStyle\">" + htmlspecialchars(t.data.code) + "</span>\n&nbsp;")
            }})
        }
    }

    e.addButton("insert_code", {icon: "insert_code", tooltip: "Thêm code", onclick: t});

});